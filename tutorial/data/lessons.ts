import type { TutorialLesson } from '../types';

export const lessons: TutorialLesson[] = [
  {
    id: 'lesson-1-connection',
    title: 'Connecting to Your Drone',
    category: 'beginner',
    description: 'Learn how to connect to the ROS system and understand the DroneBlocks interface.',
    estimatedMinutes: 3,
    icon: 'ðŸ”Œ',
    completionMessage: 'Great job! You\'re now connected and ready to start programming your drone.',
    steps: [
      {
        id: 'welcome',
        title: 'Welcome to DroneBlocks!',
        description: 'DroneBlocks is a visual programming environment for autonomous drones. You\'ll use blocks to create missions that your drone will execute.',
        instruction: 'Let\'s start by understanding the interface. On the left, you have the block workspace. On the right, you have the 3D simulator showing your drone.',
        autoAdvance: false,
      },
      {
        id: 'connect-ros',
        title: 'Connect to ROS',
        description: 'ROS (Robot Operating System) is the communication layer between DroneBlocks and your drone.',
        instruction: 'Click the "Connect to ROS" button in the top right corner.',
        highlightElement: 'button:contains("Connect to ROS")',
        hints: ['Look for the button in the header area', 'It should be near the status indicator'],
      },
      {
        id: 'check-status',
        title: 'Connection Status',
        description: 'When connected, you\'ll see a green indicator showing you\'re ready to program.',
        instruction: 'Notice the status indicator now shows "ðŸŸ¢ Connected to ROS".',
        autoAdvance: false,
      },
      {
        id: 'explore-workspace',
        title: 'Explore the Workspace',
        description: 'The workspace is where you\'ll drag and drop blocks to create your drone missions.',
        instruction: 'On the left side, you\'ll see categories like Takeoff, Navigation, LED, and more. Each category contains blocks for different drone functions.',
        autoAdvance: false,
      },
    ],
  },
  {
    id: 'lesson-2-arming',
    title: 'Arming Your Drone',
    category: 'beginner',
    description: 'Understand drone safety and learn how to arm your drone for flight.',
    estimatedMinutes: 5,
    icon: 'ðŸ›¡ï¸',
    prerequisite: 'lesson-1-connection',
    completionMessage: 'Excellent! You now know how to safely arm your drone.',
    steps: [
      {
        id: 'safety-intro',
        title: 'Safety First',
        description: 'Drones have safety features to prevent accidental activation. Arming is the first step before any flight.',
        instruction: 'Before a drone can fly, it must be "armed". This is a safety feature that ensures the motors won\'t spin accidentally.',
        autoAdvance: false,
      },
      {
        id: 'find-arm-block',
        title: 'Find the Arm Block',
        description: 'The arm block is located in the Takeoff category.',
        instruction: 'Click on the "Takeoff" category (green) in the toolbox to see available blocks.',
        highlightBlocks: ['nav_arm'],
        hints: ['Look for the green "Takeoff" category', 'It should be at the top of the toolbox'],
      },
      {
        id: 'drag-arm-block',
        title: 'Add the Arm Block',
        description: 'Drag the arm block to the workspace.',
        instruction: 'Drag the "Arm" block from the toolbox onto the workspace area.',
        highlightBlocks: ['nav_arm'],
        hints: ['Click and hold on the block', 'Drag it to the white workspace area'],
      },
      {
        id: 'run-arm',
        title: 'Execute the Mission',
        description: 'Let\'s run your first command!',
        instruction: 'Click the green "â–¶ Run Mission" button to arm the drone.',
        highlightElement: '.run-btn',
        hints: ['Look for the play button in the header', 'Make sure you\'re still connected to ROS'],
      },
      {
        id: 'observe-arming',
        title: 'Observe the Result',
        description: 'Watch the simulator and console output.',
        instruction: 'Look at the browser console (F12) to see the arm command execute. In a real drone, this would enable the motors.',
        autoAdvance: false,
      },
    ],
  },
  {
    id: 'lesson-3-offboard',
    title: 'Offboard Mode & Heartbeat',
    category: 'beginner',
    description: 'Learn about offboard control requirements and why the heartbeat is critical.',
    estimatedMinutes: 7,
    icon: 'ðŸ’“',
    prerequisite: 'lesson-2-arming',
    completionMessage: 'Perfect! You understand the critical safety system that enables autonomous flight.',
    steps: [
      {
        id: 'offboard-intro',
        title: 'What is Offboard Mode?',
        description: 'Offboard mode allows external computers to control the drone autonomously.',
        instruction: 'PX4 (the drone\'s flight controller) has different flight modes. Offboard mode allows DroneBlocks to send position and velocity commands.',
        autoAdvance: false,
      },
      {
        id: 'heartbeat-explanation',
        title: 'The Offboard Heartbeat',
        description: 'A safety mechanism that ensures the drone knows the computer is still connected.',
        instruction: 'The heartbeat sends regular signals to the drone. If the heartbeat stops, the drone knows something is wrong and will enter a safe mode.',
        autoAdvance: false,
      },
      {
        id: 'clear-workspace',
        title: 'Start Fresh',
        description: 'Let\'s build a proper mission sequence.',
        instruction: 'Right-click on your workspace and select "Delete All Blocks" or manually delete existing blocks.',
        hints: ['You can also drag blocks to the trash icon'],
      },
      {
        id: 'add-heartbeat',
        title: 'Start the Heartbeat',
        description: 'This block starts sending regular signals to the drone.',
        instruction: 'From the "Navigation" category (teal), drag the "Start offboard heartbeat" block to the workspace.',
        highlightBlocks: ['nav_start_offboard_heartbeat'],
        hints: ['Look in the Navigation category', 'It should be near the top'],
      },
      {
        id: 'add-offboard-switch',
        title: 'Switch to Offboard Mode',
        description: 'This command tells the drone to enter offboard mode.',
        instruction: 'Drag the "Switch to offboard mode" block and connect it below the heartbeat block.',
        highlightBlocks: ['nav_switch_offboard_mode'],
        hints: ['Blocks snap together when you drag them close', 'Make sure they\'re connected in order'],
      },
      {
        id: 'add-arm-again',
        title: 'Add the Arm Block',
        description: 'Now add the arm command to complete the pre-flight sequence.',
        instruction: 'Add the "Arm" block from the Takeoff category and connect it to the bottom of your sequence.',
        highlightBlocks: ['nav_arm'],
      },
      {
        id: 'run-sequence',
        title: 'Run the Pre-Flight Sequence',
        description: 'Execute all three commands in order.',
        instruction: 'Click "â–¶ Run Mission" to execute: start heartbeat â†’ switch to offboard â†’ arm.',
        highlightElement: '.run-btn',
      },
    ],
  },
  {
    id: 'lesson-4-takeoff',
    title: 'First Flight - Takeoff',
    category: 'beginner',
    description: 'Make your drone take off to a specified altitude.',
    estimatedMinutes: 5,
    icon: 'ðŸš',
    prerequisite: 'lesson-3-offboard',
    completionMessage: 'Amazing! Your drone just completed its first flight!',
    steps: [
      {
        id: 'takeoff-intro',
        title: 'Ready for Takeoff',
        description: 'Now that you understand the pre-flight sequence, let\'s make the drone fly!',
        instruction: 'Takeoff commands tell the drone to lift off and hover at a specific altitude.',
        autoAdvance: false,
      },
      {
        id: 'add-takeoff',
        title: 'Add Takeoff Block',
        description: 'The takeoff block has a parameter for altitude.',
        instruction: 'From the Takeoff category, drag the "Takeoff" block and connect it to the bottom of your existing sequence.',
        highlightBlocks: ['nav_takeoff'],
        hints: ['Look for the block with an altitude input', 'Default altitude is 2 meters'],
      },
      {
        id: 'set-altitude',
        title: 'Set Takeoff Altitude',
        description: 'You can change the altitude by clicking on the number.',
        instruction: 'Click on the number in the takeoff block. Try changing it to 2 meters (if not already set).',
        hints: ['Click directly on the number', 'Type the new value'],
      },
      {
        id: 'review-mission',
        title: 'Review Your Mission',
        description: 'Your complete mission should have 4 blocks.',
        instruction: 'Verify your mission: Start heartbeat â†’ Switch offboard â†’ Arm â†’ Takeoff to 2m.',
        autoAdvance: false,
      },
      {
        id: 'execute-takeoff',
        title: 'Execute First Flight!',
        description: 'Run the complete mission and watch the simulator.',
        instruction: 'Click "â–¶ Run Mission" and watch the right panel as your drone takes off in the simulator!',
        highlightElement: '.run-btn',
      },
      {
        id: 'observe-flight',
        title: 'Observe the Flight',
        description: 'Watch the 3D simulator carefully.',
        instruction: 'Notice how each block executes in sequence. The drone should rise to 2 meters and hold position.',
        autoAdvance: false,
      },
    ],
  },
  {
    id: 'lesson-5-led',
    title: 'LED Control',
    category: 'beginner',
    description: 'Learn to control the LED ring on your drone.',
    estimatedMinutes: 4,
    icon: 'ðŸ’¡',
    prerequisite: 'lesson-4-takeoff',
    completionMessage: 'Colorful! You can now add visual effects to your drone missions.',
    steps: [
      {
        id: 'led-intro',
        title: 'LED Ring Control',
        description: 'Your drone has an LED ring that can display colors and effects.',
        instruction: 'LEDs are great for visual feedback, status indication, or just making your drone look cool!',
        autoAdvance: false,
      },
      {
        id: 'find-led-category',
        title: 'Find LED Blocks',
        description: 'LED blocks are in their own category.',
        instruction: 'Click on the "LED" category (purple) to see available LED blocks.',
        highlightBlocks: ['led_effect', 'led_ring', 'led_pixel'],
      },
      {
        id: 'add-led-effect',
        title: 'Add LED Effect',
        description: 'Effects are pre-programmed LED animations.',
        instruction: 'Drag the "LED effect" block and add it after your takeoff block.',
        highlightBlocks: ['led_effect'],
        hints: ['Click the dropdown to see different effects', 'Try "rainbow" or "pulse"'],
      },
      {
        id: 'try-led-ring',
        title: 'Try LED Ring Color',
        description: 'You can also set a solid color for the entire ring.',
        instruction: 'Add an "LED ring" block below the effect block. Click the dropdown to choose a color.',
        highlightBlocks: ['led_ring'],
        hints: ['Colors include red, green, blue, white, etc.'],
      },
      {
        id: 'run-with-leds',
        title: 'Run Mission with LEDs',
        description: 'Execute the complete mission with LED commands.',
        instruction: 'Run your mission and watch the console for LED command confirmations.',
        highlightElement: '.run-btn',
      },
    ],
  },
  {
    id: 'lesson-6-navigation',
    title: 'Basic Navigation',
    category: 'intermediate',
    description: 'Move your drone in different directions and create a simple flight path.',
    estimatedMinutes: 8,
    icon: 'ðŸ§­',
    prerequisite: 'lesson-5-led',
    completionMessage: 'Excellent navigation! You can now create complex flight paths.',
    steps: [
      {
        id: 'nav-intro',
        title: 'Navigation Commands',
        description: 'Your drone can move in all directions: forward, backward, left, right, up, and down.',
        instruction: 'Navigation blocks take distance parameters in meters. You can also rotate the drone using yaw commands.',
        autoAdvance: false,
      },
      {
        id: 'add-forward',
        title: 'Move Forward',
        description: 'The forward block moves the drone in its current heading.',
        instruction: 'After your takeoff, add a "Fly forward" block from the Navigation category. Set it to 2 meters.',
        highlightBlocks: ['nav_fly_forward'],
      },
      {
        id: 'add-wait',
        title: 'Add a Wait',
        description: 'Wait blocks pause the mission for a specified time.',
        instruction: 'Add a "Wait" block for 3 seconds so you can observe the drone in position.',
        highlightBlocks: ['nav_wait'],
        hints: ['Wait times are in seconds'],
      },
      {
        id: 'add-yaw',
        title: 'Rotate the Drone',
        description: 'Yaw commands rotate the drone left or right.',
        instruction: 'Add a "Yaw right" block and set it to 90 degrees to rotate the drone.',
        highlightBlocks: ['nav_yaw_right', 'nav_yaw_left'],
        hints: ['90 degrees is a quarter turn', '180 degrees is a half turn'],
      },
      {
        id: 'add-more-movement',
        title: 'Create a Path',
        description: 'Add more movement commands to create an L-shaped path.',
        instruction: 'Add another "Fly forward" block for 2 meters (the drone will now move in the new direction after rotating).',
        highlightBlocks: ['nav_fly_forward'],
      },
      {
        id: 'add-landing',
        title: 'Land Safely',
        description: 'Always end your missions with a landing command.',
        instruction: 'From the "Land" category (red), add a "Land" block at the end of your mission.',
        highlightBlocks: ['nav_land'],
      },
      {
        id: 'run-nav-mission',
        title: 'Execute Navigation Mission',
        description: 'Run your complete navigation sequence.',
        instruction: 'Run the mission and watch the drone in the simulator: takeoff â†’ forward â†’ wait â†’ yaw â†’ forward â†’ land.',
        highlightElement: '.run-btn',
      },
    ],
  },
  {
    id: 'lesson-7-loops',
    title: 'Creating Patterns with Loops',
    category: 'intermediate',
    description: 'Use loops to create repeating flight patterns efficiently.',
    estimatedMinutes: 10,
    icon: 'ðŸ”',
    prerequisite: 'lesson-6-navigation',
    completionMessage: 'Outstanding! You\'ve mastered loops and can create complex patterns with minimal blocks.',
    steps: [
      {
        id: 'loop-intro',
        title: 'Why Use Loops?',
        description: 'Loops let you repeat actions without duplicating blocks.',
        instruction: 'Instead of adding the same blocks over and over, you can use a loop to repeat them. This makes your code cleaner and easier to modify.',
        autoAdvance: false,
      },
      {
        id: 'square-challenge',
        title: 'Challenge: Fly a Square',
        description: 'Create a mission that flies in a square pattern.',
        instruction: 'To fly a square, you need to: fly forward â†’ yaw 90Â° right â†’ repeat 4 times. Let\'s build this!',
        autoAdvance: false,
      },
      {
        id: 'add-repeat',
        title: 'Add a Repeat Block',
        description: 'The repeat block is in the Loops category.',
        instruction: 'After your takeoff block, add a "Repeat" block from the Loops category. Set it to repeat 4 times.',
        highlightBlocks: ['controls_repeat_ext'],
        hints: ['Click on the number to change repetitions'],
      },
      {
        id: 'add-forward-in-loop',
        title: 'Add Forward Movement',
        description: 'Place movement blocks inside the loop.',
        instruction: 'Drag a "Fly forward" block (2 meters) and place it inside the repeat block.',
        highlightBlocks: ['nav_fly_forward'],
        hints: ['Drag the block into the mouth of the repeat block'],
      },
      {
        id: 'add-yaw-in-loop',
        title: 'Add Rotation',
        description: 'Add the turn command inside the loop.',
        instruction: 'Add a "Yaw right" block (90 degrees) inside the loop, below the forward block.',
        highlightBlocks: ['nav_yaw_right'],
      },
      {
        id: 'add-final-land',
        title: 'Complete the Mission',
        description: 'Don\'t forget to land!',
        instruction: 'Add a "Land" block after the repeat loop (outside the loop, not inside).',
        highlightBlocks: ['nav_land'],
        hints: ['The land block should be at the same level as the repeat block'],
      },
      {
        id: 'run-square',
        title: 'Fly the Square!',
        description: 'Execute your pattern mission.',
        instruction: 'Run the mission. Your drone should fly in a square pattern: forward â†’ turn â†’ forward â†’ turn â†’ forward â†’ turn â†’ forward â†’ turn â†’ land.',
        highlightElement: '.run-btn',
      },
    ],
  },
  {
    id: 'lesson-8-apriltags',
    title: 'Computer Vision with AprilTags',
    category: 'advanced',
    description: 'Use AprilTag detection to create smart, reactive missions.',
    estimatedMinutes: 12,
    icon: 'ðŸ“·',
    prerequisite: 'lesson-7-loops',
    completionMessage: 'Incredible! You\'ve mastered computer vision integration. You can now create truly intelligent autonomous missions!',
    steps: [
      {
        id: 'apriltag-intro',
        title: 'What are AprilTags?',
        description: 'AprilTags are fiducial markers similar to QR codes, designed for robotics.',
        instruction: 'Your drone can detect and identify AprilTags using its camera. Each tag has a unique ID, allowing your drone to react to different markers.',
        autoAdvance: false,
      },
      {
        id: 'monitoring-concept',
        title: 'Monitoring vs Detection',
        description: 'You need to start monitoring before you can detect tags.',
        instruction: 'The "Start AprilTag monitoring" block activates the camera detection system. The drone will continuously look for tags until you stop monitoring.',
        autoAdvance: false,
      },
      {
        id: 'add-monitoring',
        title: 'Start Monitoring',
        description: 'Add the monitoring block early in your mission.',
        instruction: 'Create a new mission. After takeoff, add a "Start AprilTag monitoring" block from the AprilTags category.',
        highlightBlocks: ['apriltag_start_monitoring'],
      },
      {
        id: 'add-navigation-search',
        title: 'Navigate to Search',
        description: 'Move the drone to where it can see AprilTags.',
        instruction: 'Add some navigation blocks to move your drone around (e.g., fly forward 3 meters).',
        highlightBlocks: ['nav_fly_forward', 'nav_fly_backward', 'nav_fly_left', 'nav_fly_right'],
      },
      {
        id: 'add-if-block',
        title: 'Add Conditional Logic',
        description: 'Use an if block to check for tag detection.',
        instruction: 'From the Logic category, add an "if" block. This will let your drone make decisions based on what it sees.',
        highlightBlocks: ['controls_if'],
      },
      {
        id: 'add-comparison',
        title: 'Check Tag Count',
        description: 'Compare the detected tag count to see if tags are visible.',
        instruction: 'In the if condition, use a comparison block (=, >, <). On one side, add "Get detected tag count" block. On the other, use a number block with value greater than 0.',
        highlightBlocks: ['logic_compare', 'apriltag_get_tag_count'],
        hints: ['You\'re checking if tag count > 0', 'This means "if tags are detected"'],
      },
      {
        id: 'add-reaction',
        title: 'React to Detection',
        description: 'Add actions inside the if block.',
        instruction: 'Inside the if block, add an LED effect or color change to show the drone detected a tag!',
        highlightBlocks: ['led_effect', 'led_ring'],
      },
      {
        id: 'stop-monitoring',
        title: 'Stop Monitoring',
        description: 'Clean up by stopping the monitoring.',
        instruction: 'After your conditional logic, add a "Stop AprilTag monitoring" block before landing.',
        highlightBlocks: ['apriltag_stop_monitoring'],
      },
      {
        id: 'run-apriltag',
        title: 'Test Your Vision System',
        description: 'Run the complete computer vision mission.',
        instruction: 'Run your mission! If AprilTags are in the simulator view, your drone will detect them and react.',
        highlightElement: '.run-btn',
      },
    ],
  },
];

export function getLessonById(id: string): TutorialLesson | undefined {
  return lessons.find(lesson => lesson.id === id);
}

export function getNextLesson(currentLessonId: string): TutorialLesson | undefined {
  const currentIndex = lessons.findIndex(l => l.id === currentLessonId);
  if (currentIndex >= 0 && currentIndex < lessons.length - 1) {
    return lessons[currentIndex + 1];
  }
  return undefined;
}

export function canStartLesson(lessonId: string, completedLessons: string[]): boolean {
  const lesson = getLessonById(lessonId);
  if (!lesson) return false;
  if (!lesson.prerequisite) return true;
  return completedLessons.includes(lesson.prerequisite);
}
